(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{26:function(t,e,a){t.exports=a(41)},31:function(t,e,a){},40:function(t,e,a){},41:function(t,e,a){"use strict";a.r(e);var n=a(0),i=a.n(n),s=a(7),r=a.n(s),o=(a(31),a(1)),u=a(2),d=a(3),c=a(6),h=a(5),l=a(4),m=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"USE_IMAGE":var a=t.addImagesTransform.concat(),n=t.editorBounds,i=t.addImagesDefaultSize;return a[e.index]||(a[e.index]=[t.addImagesDefaultScale,0,0,t.addImagesDefaultScale,(n.width-i.width)/2,(n.height-i.height)/2]),Object(o.a)(Object(o.a)({},t),{},{addImagesTransform:a,justAdded:!0});case"REINIT_MOVABLE":return Object(o.a)(Object(o.a)({},t),{},{justAdded:!1});case"CLEAR_IMAGE":var s=t.addImagesTransform.concat();return s[e.index]&&(s[e.index]=null),Object(o.a)(Object(o.a)({},t),{},{addImagesTransform:s});case"UPDATE_IMAGE":var r=t.addImagesTransform.concat();return r[e.index]=e.transform,Object(o.a)(Object(o.a)({},t),{},{addImagesTransform:r});case"APP_INIT":return Object(o.a)(Object(o.a)({},t),e.data);case"SET_STORE_DATA":return Object(o.a)(Object(o.a)(Object(o.a)({},t),e.data),{},{loaded:!0});case"GO_PREV":return Object(o.a)(Object(o.a)({},t),{},{action:"prev"});case"GO_NEXT":return Object(o.a)(Object(o.a)({},t),{},{action:"next"});case"SAVE":return Object(o.a)(Object(o.a)({},t),{},{action:"save"});case"CLEAR_ACTION":return Object(o.a)(Object(o.a)({},t),{},{action:null});default:return t}},p=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;return a.extraAction&&(e=t(e,a.extraAction)),e=m(e,a)},b=function(t){Object(h.a)(a,t);var e=Object(l.a)(a);function a(t){var n;return Object(u.a)(this,a),(n=e.call(this,t)).state={},n.store=n.props.store,n.left_buttonHandler=n.left_buttonHandler.bind(Object(c.a)(n)),n.right_buttonHandler=n.right_buttonHandler.bind(Object(c.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var t=this;this.unsubscribe=this.store.subscribe((function(){t.onStoreChange()})),this.mounted=!0}},{key:"componentWillUnmount",value:function(){this.unsubscribe&&this.unsubscribe(),this.mounted=!1}},{key:"onStoreChange",value:function(){if(this.mounted){var t=this.store.getState();this.setState(t)}}},{key:"left_buttonHandler",value:function(t){this.store.dispatch({type:"GO_PREV"})}},{key:"right_buttonHandler",value:function(t){this.store.dispatch({type:"GO_NEXT"})}},{key:"render",value:function(){var t=[];return t.push(this.props.children),this.state.loaded&&(t.push(i.a.createElement("div",{id:"title",key:"title",className:"topMenuTitle"},this.state.title)),t.push(i.a.createElement("div",{id:"left",key:"left",className:"topMenuButton",style:{left:"1%"},onClick:this.left_buttonHandler},"\u041d\u0430\u0437\u0430\u0434")),t.push(i.a.createElement("div",{id:"right",key:"right",className:"topMenuButton",style:{right:"1%"},onClick:this.right_buttonHandler},"\u0412\u043f\u0435\u0440\u0435\u0434"))),i.a.createElement("div",{id:"TopMenu",style:this.props.style},t)}}]),a}(n.Component),f=function(t){Object(h.a)(a,t);var e=Object(l.a)(a);function a(t){var n;return Object(u.a)(this,a),(n=e.call(this,t)).state={},n.store=n.props.store,n.image_clickHandler=n.image_clickHandler.bind(Object(c.a)(n)),n.clear_buttonHandler=n.clear_buttonHandler.bind(Object(c.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var t=this;this.unsubscribe=this.store.subscribe((function(){t.onStoreChange()})),this.mounted=!0}},{key:"componentWillUnmount",value:function(){this.unsubscribe&&this.unsubscribe(),this.mounted=!1}},{key:"onStoreChange",value:function(){if(this.mounted){var t=this.store.getState();this.setState(t)}}},{key:"image_clickHandler",value:function(t){var e=t.target.id,a=Number(e.substr(3));this.store.dispatch(function(t){return{type:"USE_IMAGE",index:t}}(a))}},{key:"clear_buttonHandler",value:function(t){var e=t.target.id,a=Number(e.substr(3));this.store.dispatch(function(t){return{type:"CLEAR_IMAGE",index:t}}(a))}},{key:"render",value:function(){var t=[];if(t.push(this.props.children),this.state&&this.state.loaded&&this.state.addImagesSrc)for(var e=0;e<this.state.addImagesSrc.length;e++){var a=this.state.addImagesSrc[e];this.state.addImagesTransform[e]?t.push(i.a.createElement("div",{id:"clr"+e,key:"clr"+e,className:"sideMenuButton",style:{top:e/this.state.addImagesSrc.length*100+50/this.state.addImagesSrc.length+"%",transform:"translate(-50%,-50%)"},onClick:this.clear_buttonHandler},"\u0412\u0435\u0440\u043d\u0443\u0442\u044c")):t.push(i.a.createElement("img",{id:"img"+e,key:"img"+e,src:a,className:"sideMenuImage",style:{top:e/this.state.addImagesSrc.length*100+50/this.state.addImagesSrc.length+"%",transform:"translateY(-50%)",height:1/this.state.addImagesSrc.length*100+"%"},onClick:this.image_clickHandler}))}return i.a.createElement("div",{id:"SideMenu",style:this.props.style},t)}}]),a}(n.Component),g=a(17),v=function(t){Object(h.a)(a,t);var e=Object(l.a)(a);function a(t){var n;Object(u.a)(this,a),(n=e.call(this,t)).state={},n.store=n.props.store,n.currentZ=0,n.targetZs=[],n.targetRefs=[],n.moveableRefs=[];for(var s=0;s<10;s++)n.targetZs.push(0),n.targetRefs.push(i.a.createRef()),n.moveableRefs.push(i.a.createRef());return n.containerRef=i.a.createRef(),n.state={},n.movable_transformHandler=n.movable_transformHandler.bind(Object(c.a)(n)),n.movable_transformEndHandler=n.movable_transformEndHandler.bind(Object(c.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var t=this;this.unsubscribe=this.store.subscribe((function(){t.onStoreChange()})),this.mounted=!0}},{key:"componentWillUnmount",value:function(){this.unsubscribe&&this.unsubscribe(),this.mounted=!1}},{key:"componentDidUpdate",value:function(t,e,a){}},{key:"onStoreChange",value:function(){if(this.mounted){var t=this.store.getState();this.setState(t)}}},{key:"movable_transformHandler",value:function(t){t.transform&&(t.target.style.transform=t.transform);Number(t.target.id.substr(3))}},{key:"movable_transformEndHandler",value:function(t){var e=Number(t.target.id.substr(3)),a=/\((.+),\s*(.+),\s*(.+),\s*(.+),\s*(.+),\s*(.+)\)/g.exec(window.getComputedStyle(t.target,null).transform),n=[1,0,0,1,0,0];if(a){a.splice(0,1),n=[];for(var i=0;i<a.length;i++)n.push(a[i])}this.currentZ++,this.targetZs[e]=this.currentZ,this.store.dispatch(function(t,e){return{type:"UPDATE_IMAGE",index:t,transform:e}}(e,n))}},{key:"render",value:function(){var t=[];if(t.push(this.props.children),this.state.addImagesSrc){for(var e=[],a=0;a<this.state.addImagesSrc.length;a++)e.push({i:a,z:this.targetZs[a]});e.sort((function(t,e){return t.z-e.z}));for(var n=0;n<e.length;n++){var s=e[n].i,r=this.state.addImagesSrc[s],o=this.state.addImagesTransform[s];o&&(t.push(i.a.createElement("img",{id:"img"+s,key:"img"+s,src:r,className:"editorImage",ref:this.targetRefs[s],style:{transform:"matrix(".concat(o,")"),width:this.state.addImagesDefaultSize.width,height:this.state.addImagesDefaultSize.height},onLoad:this.movable_transformEndHandler,onMouseDown:this.movable_transformEndHandler})),t.push(i.a.createElement(g.a,{key:"Moveable"+s,ref:this.moveableRefs[s],target:this.targetRefs[s].current,pinchThreshold:20,container:this.containerRef.current,draggable:!0,scalable:!0,resizable:!1,warpable:!1,rotatable:!0,pinchable:!1,keepRatio:!0,origin:!1,throttleDrag:1.5,throttleRotate:.2,throttleResize:1,throttleScale:.01,onDrag:this.movable_transformHandler,onResize:this.movable_transformHandler,onScale:this.movable_transformHandler,onWarp:this.movable_transformHandler,onRotate:this.movable_transformHandler,onPinch:this.movable_transformHandler,onDragEnd:this.movable_transformEndHandler,onScaleEnd:this.movable_transformEndHandler,onResizeEnd:this.movable_transformEndHandler,onWarpEnd:this.movable_transformEndHandler,onRotateEnd:this.movable_transformEndHandler,onPinchEnd:this.movable_transformEndHandler})))}}return i.a.createElement("div",{id:"Editor",style:this.props.style,ref:this.containerRef},t)}}]),a}(n.Component),y=function(t){Object(h.a)(a,t);var e=Object(l.a)(a);function a(t){var n;return Object(u.a)(this,a),(n=e.call(this,t)).store=n.props.store,n.ref=i.a.createRef(),n.containerRef=i.a.createRef(),n.editorRef=i.a.createRef(),n.state={editorScale:.15,editorX:0,editorY:0},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var t=this;this.unsubscribe=this.store.subscribe((function(){t.onStoreChange()})),this.mounted=!0}},{key:"componentWillUnmount",value:function(){this.unsubscribe&&this.unsubscribe(),this.mounted=!1}},{key:"componentDidUpdate",value:function(t,e,a){this.updateBounds(this.ref.current.clientWidth,this.ref.current.clientHeight)}},{key:"onStoreChange",value:function(){if(this.mounted){var t=this.store.getState();this.setState(Object(o.a)(Object(o.a)({},this.state),t))}}},{key:"updateBounds",value:function(t,e){if((this.lastWidth!==t||this.lastHeight!==e)&&this.state.editorBounds){this.lastWidth=t,this.lastHeight=e;var a=this.state.editorBounds,n=Math.min(t/a.width,e/a.height),i=(t-a.width*n)/2/n,s=(e-a.height*n)/2/n;this.setState(Object(o.a)(Object(o.a)({},this.state),{},{editorScale:n,editorX:i,editorY:s}))}}},{key:"render",value:function(){var t=[];return t.push(this.props.children),t.push(i.a.createElement("div",{id:"EditorContainer",key:"EditorContainer",ref:this.containerRef,style:{width:this.state.editorBounds?this.state.editorBounds.width:0,height:this.state.editorBounds?this.state.editorBounds.height:0,transform:"scale(".concat(this.state.editorScale,") translateX(").concat(this.state.editorX,"px) translateY(").concat(this.state.editorY,"px)")}},i.a.createElement(v,{id:"Editor",key:"Editor",scale:this.state.editorScale,store:this.props.store,ref:this.editorRef,style:{width:this.state.editorBounds?this.state.editorBounds.width:0,height:this.state.editorBounds?this.state.editorBounds.height:0}}),i.a.createElement("img",{id:"MainImage",key:"MainImage",src:this.state.mainImageSrc}))),i.a.createElement("div",{id:"EditorPlace",style:this.props.style,ref:this.ref},t)}}]),a}(n.Component),E=function(t){Object(h.a)(a,t);var e=Object(l.a)(a);function a(t){var n;return Object(u.a)(this,a),(n=e.call(this,t)).state={},n.store=n.props.store,n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var t=this;this.unsubscribe=this.store.subscribe((function(){t.onStoreChange()})),this.mounted=!0}},{key:"componentWillUnmount",value:function(){this.unsubscribe&&this.unsubscribe(),this.mounted=!1}},{key:"componentDidUpdate",value:function(t,e,a){}},{key:"onStoreChange",value:function(){if(this.mounted){var t=this.store.getState();this.setState(t)}}},{key:"render",value:function(){var t=[];return t.push(this.props.children),t.push(i.a.createElement(f,{store:this.store,key:"SideMenu",style:{width:this.state.sideMenu?this.state.sideMenu.width:0,top:this.state.topMenu?this.state.topMenu.height:0}})),t.push(i.a.createElement(y,{store:this.store,key:"EditorPlace",style:{right:this.state.sideMenu?this.state.sideMenu.width:0,top:this.state.topMenu?this.state.topMenu.height:0}})),t.push(i.a.createElement(b,{store:this.store,key:"TopMenu",style:{height:this.state.topMenu?this.state.topMenu.height:0}})),i.a.createElement("div",{id:"Container"},t)}}]),a}(n.Component),S=function(t){Object(h.a)(a,t);var e=Object(l.a)(a);function a(t){var n;return Object(u.a)(this,a),(n=e.call(this,t)).store=n.props.store,n.state={isLoading:!1,isLoaded:!1},n.loader=null,n.result=null,n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var t=this;this.unsubscribe=this.store.subscribe((function(){t.onStoreChange()})),this.mounted=!0}},{key:"componentWillUnmount",value:function(){this.unsubscribe&&this.unsubscribe(),this.mounted=!1}},{key:"componentDidUpdate",value:function(t,e){}},{key:"onStoreChange",value:function(){if(this.mounted){var t=this.store.getState();t.reloadData||t.saveStorageData&&this.saveStorageData()}}},{key:"loadStorageData",value:function(){var t=this.localStorageManager.load();this.store.dispatch(function(t){return{type:"SET_STORAGE_DATA",data:t}}(t))}},{key:"saveStorageData",value:function(){this.localStorageManager.save({}),this.store.dispatch({type:"STORAGE_DATA_SAVED",data:{saveStorageData:!1}})}},{key:"render",value:function(){return null}}]),a}(n.Component),O=function(t){Object(h.a)(a,t);var e=Object(l.a)(a);function a(t){var n;return Object(u.a)(this,a),(n=e.call(this,t)).state={},n.store=n.props.store,n.actionMap={},n.appStartDelay=500,n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var t=this;this.unsubscribe=this.store.subscribe((function(){t.onStoreChange()})),this.mounted=!0}},{key:"componentWillUnmount",value:function(){this.unsubscribe&&this.unsubscribe(),this.mounted=!1}},{key:"onStoreChange",value:function(){var t=this;if(this.mounted){var e=this.store.getState();if(e.justAdded&&(this.loadTimeout=setTimeout((function(){t.store.dispatch({type:"REINIT_MOVABLE"})}),100)),e.justAdded&&(this.loadTimeout=setTimeout((function(){t.store.dispatch({type:"REINIT_MOVABLE"})}),100)),e.action)switch(this.store.dispatch({type:"CLEAR_ACTION"}),e.action){case"next":this.props.app.props.onNext(this.props.app);break;case"prev":this.props.app.props.onPrev(this.props.app);break;case"save":this.props.app.props.onSave(this.props.app)}e.dataForStorageChanged&&this.store.dispatch({type:"SAVE_STORAGE_DATA",data:{saveStorageData:!0,dataForStorageChanged:null}})}}},{key:"stopTimeout",value:function(){this.loadTimeout&&(clearTimeout(this.loadTimeout),this.loadTimeout=null)}},{key:"waitForReload",value:function(){var t=this;this.stopTimeout(),this.loadTimeout=setTimeout((function(){t.store.dispatch({type:"RELOAD_STORE_DATA",data:{dataLoaded:!1,reloadData:!0,loadDataError:!1}})}),this.store.reloadTimeout)}},{key:"render",value:function(){return null}}]),a}(n.Component),k=a(16),_=a(8),j=a(14),w=a.n(j),I=(a(15),{assetsUrl:".",localStoreName:"appState_261020",isMobile:new w.a(window.navigator.userAgent).mobile(),isLocal:!/^h/.test(document.location.toString()),topMenu:{height:"5%"},sideMenu:{width:"10%"},editorBounds:{width:0,height:0},addImagesDefaultSize:{width:500,height:500},addImagesDefaultScale:.5,mainImageSrc:"",addImagesSrc:["","",""],addImagesTransform:[null,null,null],title:""}),T=(a(40),Object(_.b)(p,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__())),H=function(t){Object(h.a)(a,t);var e=Object(l.a)(a);function a(t){var n;return Object(u.a)(this,a),(n=e.call(this,t)).state={},n.initHandler=n.initHandler.bind(Object(c.a)(n)),n.resizeHandler=n.resizeHandler.bind(Object(c.a)(n)),n}return Object(d.a)(a,[{key:"updateLayout",value:function(){var t=document.documentElement.clientWidth||document.body.clientWidth||window.innerWidth,e=document.documentElement.clientHeight||document.body.clientHeight||window.innerHeight;this.setState(Object(o.a)(Object(o.a)({},this.state),{},{windowWidth:t,windowHeight:e}))}},{key:"initHandler",value:function(t){this.updateLayout()}},{key:"resizeHandler",value:function(t){this.updateLayout()}},{key:"setData",value:function(t){T.dispatch(function(t){return{type:"SET_STORE_DATA",data:Object(o.a)({},t)}}(t))}},{key:"getData",value:function(t){return T.getState()}},{key:"componentDidUpdate",value:function(t,e,a){}},{key:"componentDidMount",value:function(){var t;T.dispatch((t=I,{type:"APP_INIT",data:Object(o.a)({},t)})),window.addEventListener("load",this.initHandler),window.addEventListener("resize",this.resizeHandler),this.props.onInit(this)}},{key:"render",value:function(){return i.a.createElement(k.a,{store:T},i.a.createElement(E,{id:"Container",windowWidth:this.state.windowWidth,windowHeight:this.state.windowHeight,store:T},i.a.createElement(S,{store:T}),i.a.createElement(O,{app:this,store:T})))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var A=document.getElementById("editorWidget");console.log(A.getAttribute("oninit")),r.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(H,{id:"editorApp",onInit:window[A.getAttribute("oninit")],onNext:window[A.getAttribute("onnext")],onPrev:window[A.getAttribute("onprev")]})),A),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[26,1,2]]]);
//# sourceMappingURL=main.cf60e5be.chunk.js.map